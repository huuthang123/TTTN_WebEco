{"ast":null,"code":"import React,{createContext,useState,useContext,useEffect}from'react';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{const token=localStorage.getItem('token');if(token){axios.get('http://localhost:5000/api/users/me',{headers:{Authorization:`Bearer ${token}`}}).then(response=>{setUser(response.data);setLoading(false);}).catch(error=>{var _error$response;console.error('Lỗi khi lấy thông tin user:',(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data);localStorage.removeItem('token');setUser(null);setLoading(false);});}else{setLoading(false);}},[]);const login=async(email,password)=>{try{if(!email||!password){throw new Error('Vui lòng nhập email và mật khẩu.');}const response=await axios.post('http://localhost:5000/api/users/login',{email,password});const{token}=response.data;localStorage.setItem('token',token);const userResponse=await axios.get('http://localhost:5000/api/users/me',{headers:{Authorization:`Bearer ${token}`}});setUser(userResponse.data);}catch(error){var _error$response2,_error$response2$data;const errorMessage=((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||'Email hoặc mật khẩu không đúng';throw new Error(errorMessage);}};const register=async(username,email,phone,password)=>{try{if(!username||!email||!phone||!password){throw new Error('Vui lòng nhập đầy đủ thông tin.');}const response=await axios.post('http://localhost:5000/api/users/register',{username,email,phone,password});const{token}=response.data;localStorage.setItem('token',token);const userResponse=await axios.get('http://localhost:5000/api/users/me',{headers:{Authorization:`Bearer ${token}`}});setUser(userResponse.data);}catch(error){var _error$response3,_error$response3$data;const errorMessage=((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.message)||'Đăng ký thất bại';throw new Error(errorMessage);}};const logout=()=>{localStorage.removeItem('token');setUser(null);};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,loading,login,register,logout},children:children});};export const useAuth=()=>useContext(AuthContext);","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","axios","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","loading","setLoading","token","localStorage","getItem","get","headers","Authorization","then","response","data","catch","error","_error$response","console","removeItem","login","email","password","Error","post","setItem","userResponse","_error$response2","_error$response2$data","errorMessage","message","register","username","phone","_error$response3","_error$response3$data","logout","Provider","value","useAuth"],"sources":["D:/Năm 4 Kì 2/Phát triển hệ thống thương mại điện tử/ecommerce-app/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\r\nimport axios from 'axios';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n    const [user, setUser] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const token = localStorage.getItem('token');\r\n        if (token) {\r\n            axios\r\n                .get('http://localhost:5000/api/users/me', {\r\n                    headers: { Authorization: `Bearer ${token}` },\r\n                })\r\n                .then((response) => {\r\n                    setUser(response.data);\r\n                    setLoading(false);\r\n                })\r\n                .catch((error) => {\r\n                    console.error('Lỗi khi lấy thông tin user:', error.response?.data);\r\n                    localStorage.removeItem('token');\r\n                    setUser(null);\r\n                    setLoading(false);\r\n                });\r\n        } else {\r\n            setLoading(false);\r\n        }\r\n    }, []);\r\n\r\n    const login = async (email, password) => {\r\n        try {\r\n            if (!email || !password) {\r\n                throw new Error('Vui lòng nhập email và mật khẩu.');\r\n            }\r\n            const response = await axios.post('http://localhost:5000/api/users/login', {\r\n                email,\r\n                password,\r\n            });\r\n            const { token } = response.data;\r\n            localStorage.setItem('token', token);\r\n            const userResponse = await axios.get('http://localhost:5000/api/users/me', {\r\n                headers: { Authorization: `Bearer ${token}` },\r\n            });\r\n            setUser(userResponse.data);\r\n        } catch (error) {\r\n            const errorMessage = error.response?.data?.message || 'Email hoặc mật khẩu không đúng';\r\n            throw new Error(errorMessage);\r\n        }\r\n    };\r\n\r\n    const register = async (username, email, phone, password) => {\r\n        try {\r\n            if (!username || !email || !phone || !password) {\r\n                throw new Error('Vui lòng nhập đầy đủ thông tin.');\r\n            }\r\n            const response = await axios.post('http://localhost:5000/api/users/register', {\r\n                username,\r\n                email,\r\n                phone,\r\n                password,\r\n            });\r\n            const { token } = response.data;\r\n            localStorage.setItem('token', token);\r\n            const userResponse = await axios.get('http://localhost:5000/api/users/me', {\r\n                headers: { Authorization: `Bearer ${token}` },\r\n            });\r\n            setUser(userResponse.data);\r\n        } catch (error) {\r\n            const errorMessage = error.response?.data?.message || 'Đăng ký thất bại';\r\n            throw new Error(errorMessage);\r\n        }\r\n    };\r\n\r\n    const logout = () => {\r\n        localStorage.removeItem('token');\r\n        setUser(null);\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider value={{ user, loading, login, register, logout }}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useAuth = () => useContext(AuthContext);"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}